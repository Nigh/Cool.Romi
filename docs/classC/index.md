# class.C 精简系协议 *[v1.0.4](docs/classC/changelog.md)*



## 序

协议格式如下：

| bytes | 0    | 1    | 2    | 3    | 6&#126;n  |
| :---- | :--- | :--- | :--- | :--- | :--- |
| -     |流控   | 长度   | 接口索引 | 操作数  | 参数   |

## 约定

> [!NOTE]
> `->MCU`指发送至MCU  
> `MCU->`指从MCU发出  
> 类似标记同理


> [!WARNING]
> 本文档中无前缀数字，如`13`代表十进制数  
> 前缀`0x`数字，如`0x13`代表十六进制数  
> 前缀`0b`数字，如`0b11011011`代表二进制数  




### 流控

使用一个`byte`，每发一个数据包，此`byte`加一。使用此`byte`作为最近发送数据包的唯一标识。可用于数据完整性的验证以及数据丢失的检测。

ps. 每条通信逻辑链路的流控由发起方维持。



### 错误

`0xFF`的接口索引表示返回了一个错误。

当长度为`3`时，表示返回了一个`16位`的通用错误代码。

| Code | 含义               |
| ---- | ------------------ |
| 401  | 设备未注册         |
| 404  | 接口不存在         |
| 405  | 无效的操作数       |
| 406  | 无效的参数         |
| 410  | 方法未实现或已删除 |

> 例：  
> `->MCU:fc,length=3,0xAB,0x02,0x01`  
> `MCU->:fc,length=3,0xFF,0x94,0x01` 返回错误`0x194=404`，表示接口`0xAB`不存在



## 设备端接口

接口均使用`接口索引+操作数+参数`的描述方式

> [!NOTE]
> 无参数返回默认表示`ACK`

> [!NOTE]
> 接口中如有版本号标注，表示支持此条协议的最低固件版本

| 接口   | 说明                           |
| ---- | ---------------------------- |
| [时间日期](docs/classC/timedate.md)`0x01` | 本地时间与日期的设置与获取接口 |
| [指针控制](docs/classC/hand.md)`0x02` |手表指针的控制接口|
| [通知提醒](docs/classC/notify.md)`0x03`   |提醒信息的更新与删除|
| [系统设置](docs/classC/syssetting.md)`0x04` |更改系统设置的专门接口|
| [闹钟设定](docs/classC/alarm.md)`0x05`   |设置闹钟信息的专门接口|
| [系统信息](docs/classC/sysinfo.md)`0x06` |获取如版本号等系统信息|
| [系统操作](docs/classC/sysctrl.md)`0x07` |执行如重启等系统操作|
| [数据交互](docs/classC/data.md)`0x08` |数据交换和功能交互|

## 移动端接口

| 接口   | 说明                   |
| ---- | -------------------- |
| [应用功能](docs/classC/m_func.md)`0x81` | 移动端的功能接口 |
| [系统信息](docs/classC/m_info.md)`0x82` | 获取移动端的信息 |

